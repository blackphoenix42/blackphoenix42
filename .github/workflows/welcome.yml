name: Welcome Contributors

on:
  workflow_dispatch:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const author = context.payload.sender.login;
            
            try {
              // Simple check for first-time contributor
              const isFirstTime = async () => {
                try {
                  const issues = await github.rest.issues.listForRepo({
                    owner, repo, creator: author, per_page: 2
                  });
                  return issues.data.length <= 1;
                } catch { return false; }
              };
              
              if (await isFirstTime()) {
                if (context.eventName === 'issues') {
                  const message = '👋 Welcome @' + author + '! Thanks for your first issue! 🎉\n\nPlease check our:\n- [Contributing Guidelines](CONTRIBUTING.md)\n- [Code of Conduct](CODE_OF_CONDUCT.md)\n\nI\'ll review this soon. Thanks for contributing! 🙏';

                  await github.rest.issues.createComment({
                    owner, repo,
                    issue_number: context.payload.issue.number,
                    body: message
                  });
                  
                  await github.rest.issues.addLabels({
                    owner, repo,
                    issue_number: context.payload.issue.number,
                    labels: ['first-time-contributor']
                  });
                }
              }
            } catch (error) {
              console.log('Error in welcome workflow:', error);
            }
